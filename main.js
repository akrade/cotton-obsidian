"use strict";var nt=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var er=Object.getOwnPropertyNames;var tr=Object.prototype.hasOwnProperty;var rr=(s,e)=>{for(var t in e)nt(s,t,{get:e[t],enumerable:!0})},sr=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of er(e))!tr.call(s,n)&&n!==t&&nt(s,n,{get:()=>e[n],enumerable:!(r=Zt(e,n))||r.enumerable});return s};var nr=s=>sr(nt({},"__esModule",{value:!0}),s);var Wr={};rr(Wr,{default:()=>tt});module.exports=nr(Wr);var Yt=require("obsidian");var k=require("obsidian"),ke=class extends k.PluginSettingTab{plugin;constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Cotton AI Settings"}),new k.Setting(e).setName("Claude API Key").setDesc("Your Anthropic API key for Claude").addText(t=>t.setPlaceholder("sk-ant-...").setValue(this.plugin.settings.apiKey).onChange(async r=>{this.plugin.settings.apiKey=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("Model").setDesc("Claude model to use for responses").addDropdown(t=>t.addOption("claude-sonnet-4-20250514","Claude Sonnet 4 (Recommended)").addOption("claude-opus-4-20250514","Claude Opus 4 (Most capable)").addOption("claude-3-5-haiku-20241022","Claude 3.5 Haiku (Fastest)").setValue(this.plugin.settings.model).onChange(async r=>{this.plugin.settings.model=r,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Preferences"}),new k.Setting(e).setName("Personal Preferences Path").setDesc("Path to your personal Cotton preferences (e.g., ~/.cotton/preferences)").addText(t=>t.setPlaceholder("~/.cotton/preferences").setValue(this.plugin.settings.personalPrefsPath).onChange(async r=>{this.plugin.settings.personalPrefsPath=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("Team Preferences Path").setDesc("Path to team Cotton preferences (e.g., .cotton/preferences)").addText(t=>t.setPlaceholder(".cotton/preferences").setValue(this.plugin.settings.teamPrefsPath).onChange(async r=>{this.plugin.settings.teamPrefsPath=r,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Behavior"}),new k.Setting(e).setName("Stream Responses").setDesc("Show responses as they are generated").addToggle(t=>t.setValue(this.plugin.settings.streamResponses).onChange(async r=>{this.plugin.settings.streamResponses=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("Context Lines").setDesc("Number of lines from current note to include as context").addSlider(t=>t.setLimits(0,500,10).setValue(this.plugin.settings.contextLines).setDynamicTooltip().onChange(async r=>{this.plugin.settings.contextLines=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("Include Backlinks").setDesc("Include backlink information in context").addToggle(t=>t.setValue(this.plugin.settings.includeBacklinks).onChange(async r=>{this.plugin.settings.includeBacklinks=r,await this.plugin.saveSettings()}))}};var j="0.39.0";var Et=!1,D,it,ir,or,ar,Mt,cr,Ee,ot,At,at,Me,Rt;function Ct(s,e={auto:!1}){if(Et)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${s.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(D)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${s.kind}'\` after \`import '@anthropic-ai/sdk/shims/${D}'\``);Et=e.auto,D=s.kind,it=s.fetch,ir=s.Request,or=s.Response,ar=s.Headers,Mt=s.FormData,cr=s.Blob,Ee=s.File,ot=s.ReadableStream,At=s.getMultipartRequestOptions,at=s.getDefaultAgent,Me=s.fileFromPath,Rt=s.isFsReadStream}var Ae=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function vt({manuallyImported:s}={}){let e=s?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n",t,r,n,i;try{t=fetch,r=Request,n=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new Ae(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:o=>!1}}D||Ct(vt(),{auto:!0});var c=class extends Error{},p=class s extends c{constructor(e,t,r,n){super(`${s.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.request_id=n?.["request-id"],this.error=t}static makeMessage(e,t,r){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new N({message:r,cause:Re(t)});let i=t;return e===400?new re(e,i,r,n):e===401?new se(e,i,r,n):e===403?new ne(e,i,r,n):e===404?new ie(e,i,r,n):e===409?new oe(e,i,r,n):e===422?new ae(e,i,r,n):e===429?new ce(e,i,r,n):e>=500?new le(e,i,r,n):new s(e,i,r,n)}},g=class extends p{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},N=class extends p{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},X=class extends N{constructor({message:e}={}){super({message:e??"Request timed out."})}},re=class extends p{},se=class extends p{},ne=class extends p{},ie=class extends p{},oe=class extends p{},ae=class extends p{},ce=class extends p{},le=class extends p{};var Ce=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},L=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},b,C=class{constructor(){b.set(this,void 0),this.buffer=new Uint8Array,Ce(this,b,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let n=[],i;for(;(i=dr(this.buffer,L(this,b,"f")))!=null;){if(i.carriage&&L(this,b,"f")==null){Ce(this,b,i.index,"f");continue}if(L(this,b,"f")!=null&&(i.index!==L(this,b,"f")+1||i.carriage)){n.push(this.decodeText(this.buffer.slice(0,L(this,b,"f")-1))),this.buffer=this.buffer.slice(L(this,b,"f")),Ce(this,b,null,"f");continue}let o=L(this,b,"f")!==null?i.preceding-1:i.preceding,a=this.decodeText(this.buffer.slice(0,o));n.push(a),this.buffer=this.buffer.slice(i.index),Ce(this,b,null,"f")}return n}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new c(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new c(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new c("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};b=new WeakMap;C.NEWLINE_CHARS=new Set([`
`,"\r"]);C.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function dr(s,e){for(let n=e??0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Bt(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}function ue(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var E=class s{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*n(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of hr(e,t)){if(o.event==="completion")try{yield JSON.parse(o.data)}catch(a){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),a}if(o.event==="message_start"||o.event==="message_delta"||o.event==="message_stop"||o.event==="content_block_start"||o.event==="content_block_delta"||o.event==="content_block_stop")try{yield JSON.parse(o.data)}catch(a){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),a}if(o.event!=="ping"&&o.event==="error")throw p.generate(void 0,`SSE Error: ${o.data}`,o.data,lt(e.headers))}i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new s(n,t)}static fromReadableStream(e,t){let r=!1;async function*n(){let o=new C,a=ue(e);for await(let h of a)for(let f of o.decode(h))yield f;for(let h of o.flush())yield h}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let a of n())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||t.abort()}}return new s(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new s(()=>n(e),this.controller),new s(()=>n(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new ot({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await t.next();if(o)return n.close();let a=r.encode(JSON.stringify(i)+`
`);n.enqueue(a)}catch(i){n.error(i)}},async cancel(){await t.return?.()}})}};async function*hr(s,e){if(!s.body)throw e.abort(),new c("Attempted to iterate over a response with no body");let t=new ct,r=new C,n=ue(s.body);for await(let i of fr(n))for(let o of r.decode(i)){let a=t.decode(o);a&&(yield a)}for(let i of r.flush()){let o=t.decode(i);o&&(yield o)}}async function*fr(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=Bt(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var ct=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=pr(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function pr(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}var mr=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",gr=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&de(s),de=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function";async function It(s,e,t){if(s=await s,gr(s))return s;if(mr(s)){let n=await s.blob();e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=de(n)?[await n.arrayBuffer()]:[n];return new Ee(i,e,t)}let r=await yr(s);if(e||(e=br(s)??"unknown_file"),!t?.type){let n=r[0]?.type;typeof n=="string"&&(t={...t,type:n})}return new Ee(r,e,t)}async function yr(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(de(s))e.push(await s.arrayBuffer());else if(_r(s))for await(let t of s)e.push(t);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${s?.constructor?.name}; props: ${wr(s)}`);return e}function wr(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function br(s){return ut(s.name)||ut(s.filename)||ut(s.path)?.split(/[\\/]/).pop()}var ut=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},_r=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",dt=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody";var Sr=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},Pr=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},ve;async function qt(s){let{response:e}=s;if(s.options.stream)return J("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):E.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;let t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){let i=await e.json();return J("response",e.status,e.url,e.headers,i),$t(i,e)}let n=await e.text();return J("response",e.status,e.url,e.headers,n),n}function $t(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Ie=class s extends Promise{constructor(e,t=qt){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new s(this.responsePromise,async t=>$t(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Te=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:i}){this.baseURL=e,this.maxRetries=ht("maxRetries",t),this.timeout=ht("timeout",r),this.httpAgent=n,this.fetch=i??it}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Ar(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Ir()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async n=>{let i=n&&de(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){e={...e};let{method:r,path:n,query:i,headers:o={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:dt(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,h=this.calculateContentLength(a),f=this.buildURL(n,i);"timeout"in e&&ht("timeout",e.timeout),e.timeout=e.timeout??this.timeout;let _=e.httpAgent??this.httpAgent??at(f),T=e.timeout+1e3;typeof _?.options?.timeout=="number"&&T>(_.options.timeout??0)&&(_.options.timeout=T),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let Pe=this.buildHeaders({options:e,headers:o,contentLength:h,retryCount:t});return{req:{method:r,...a&&{body:a},headers:Pe,..._&&{agent:_},signal:e.signal??null},url:f,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let i={};r&&(i["content-length"]=r);let o=this.defaultHeaders(e);return Ft(i,o),Ft(i,t),dt(e.body)&&D!=="node"&&delete i["content-type"],Be(o,"x-stainless-retry-count")===void 0&&Be(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(n)),Be(o,"x-stainless-timeout")===void 0&&Be(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(i,t),i}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new c("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,n){return p.generate(e,t,r,n)}request(e,t=null){return new Ie(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,n=r.maxRetries??this.maxRetries;t==null&&(t=n),await this.prepareOptions(r);let{req:i,url:o,timeout:a}=this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(i,{url:o,options:r}),J("request",o,r,i.headers),r.signal?.aborted)throw new g;let h=new AbortController,f=await this.fetchWithTimeout(o,i,a,h).catch(Re);if(f instanceof Error){if(r.signal?.aborted)throw new g;if(t)return this.retryRequest(r,t);throw f.name==="AbortError"?new X:new N({cause:f})}let _=lt(f.headers);if(!f.ok){if(t&&this.shouldRetry(f)){let st=`retrying, ${t} attempts remaining`;return J(`response (error; ${st})`,f.status,o,_),this.retryRequest(r,t,_)}let T=await f.text().catch(st=>Re(st).message),Pe=Rr(T),rt=Pe?void 0:T;throw J(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,f.status,o,_,rt),this.makeStatusError(f.status,Pe,rt,_)}return{response:f,options:r,controller:h}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new ft(this,r,e)}buildURL(e,t){let r=vr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return he(n)||(t={...n,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new c(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:i,...o}=t||{};i&&i.addEventListener("abort",()=>n.abort());let a=setTimeout(()=>n.abort(),r),h={signal:n.signal,...o};h.method&&(h.method=h.method.toUpperCase());let f=60*1e3,_=setTimeout(()=>{if(h&&h?.agent?.sockets)for(let T of Object.values(h?.agent?.sockets).flat())T?.setKeepAlive&&T.setKeepAlive(!0,f)},f);return this.fetch.call(void 0,e,h).finally(()=>{clearTimeout(a),clearTimeout(_)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let n,i=r?.["retry-after-ms"];if(i){let a=parseFloat(i);Number.isNaN(a)||(n=a)}let o=r?.["retry-after"];if(o&&!n){let a=parseFloat(o);Number.isNaN(a)?n=Date.parse(o)-Date.now():n=a*1e3}if(!(n&&0<=n&&n<60*1e3)){let a=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,a)}return await Br(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${j}`}},Ne=class{constructor(e,t,r,n){ve.set(this,void 0),Sr(this,ve,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new c("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[n,i]of r)e.url.searchParams.set(n,i);t.query=void 0,t.path=e.url.toString()}return await Pr(this,ve,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ve=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},ft=class extends Ie{constructor(e,t,r){super(t,async n=>new r(e,n.response,await qt(n),n.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},lt=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),kr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},x=s=>typeof s=="object"&&s!==null&&!he(s)&&Object.keys(s).every(e=>jt(kr,e)),Er=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":j,"X-Stainless-OS":Nt(Deno.build.os),"X-Stainless-Arch":Tt(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":j,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":j,"X-Stainless-OS":Nt(process.platform),"X-Stainless-Arch":Tt(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let s=Mr();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":j,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":j,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Mr(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var Tt=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Nt=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Ot,Ar=()=>Ot??(Ot=Er()),Rr=s=>{try{return JSON.parse(s)}catch{return}},Cr=/^[a-z][a-z0-9+.-]*:/i,vr=s=>Cr.test(s),Br=s=>new Promise(e=>setTimeout(e,s)),ht=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new c(`${s} must be an integer`);if(e<0)throw new c(`${s} must be a positive integer`);return e},Re=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(String(s))};var Oe=s=>{if(typeof process<"u")return process.env?.[s]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(s)?.trim()};function he(s){if(!s)return!0;for(let e in s)return!1;return!0}function jt(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Ft(s,e){for(let t in e){if(!jt(e,t))continue;let r=t.toLowerCase();if(!r)continue;let n=e[t];n===null?delete s[r]:n!==void 0&&(s[r]=n)}}function J(s,...e){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`Anthropic:DEBUG:${s}`,...e)}var Ir=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),Dt=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Tr=s=>typeof s?.get=="function";var Be=(s,e)=>{let t=e.toLowerCase();if(Tr(s)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(n,i,o)=>i+o.toUpperCase());for(let n of[e,t,e.toUpperCase(),r]){let i=s.get(n);if(i)return i}}for(let[r,n]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(n)?(n.length<=1||console.warn(`Received ${n.length} entries for the ${e} header, using the first entry.`),n[0]):n};var M=class extends Ne{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){if(this.options.query?.before_id){let t=this.first_id;return t?{params:{before_id:t}}:null}let e=this.last_id;return e?{params:{after_id:e}}:null}};var m=class{constructor(e){this._client=e}};var U=class extends m{retrieve(e,t){return this._client.get(`/v1/models/${e}?beta=true`,t)}list(e={},t){return x(e)?this.list({},e):this._client.getAPIList("/v1/models?beta=true",G,{query:e,...t})}},G=class extends M{};U.BetaModelInfosPage=G;var z=class s{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new C;for await(let t of this.iterator)for(let r of e.decode(t))yield JSON.parse(r);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new c("Attempted to iterate over a response with no body");return new s(ue(e.body),t)}};var W=class extends m{create(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t?.headers}})}retrieve(e,t={},r){if(x(t))return this.retrieve(e,{},t);let{betas:n}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...r?.headers}})}list(e={},t){if(x(e))return this.list({},e);let{betas:r,...n}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",Q,{query:n,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t?.headers}})}delete(e,t={},r){if(x(t))return this.delete(e,{},t);let{betas:n}=t;return this._client.delete(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...r?.headers}})}cancel(e,t={},r){if(x(t))return this.cancel(e,{},t);let{betas:n}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),...r?.headers}})}async results(e,t={},r){if(x(t))return this.results(e,{},t);let n=await this.retrieve(e);if(!n.results_url)throw new c(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);let{betas:i}=t;return this._client.get(n.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary",...r?.headers},__binaryResponse:!0})._thenUnwrap((o,a)=>z.fromResponse(a.response,a.controller))}},Q=class extends M{};W.BetaMessageBatchesPage=Q;var qr=s=>{let e=0,t=[];for(;e<s.length;){let r=s[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let a="",h=!1;for(r=s[++e];r!=='"';){if(e===s.length){h=!0;break}if(r==="\\"){if(e++,e===s.length){h=!0;break}a+=r+s[e],r=s[++e]}else a+=r,r=s[++e]}r=s[++e],h||t.push({type:"string",value:a});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let a="";for(r==="-"&&(a+=r,r=s[++e]);r&&i.test(r)||r===".";)a+=r,r=s[++e];t.push({type:"number",value:a});continue}let o=/[a-z]/i;if(r&&o.test(r)){let a="";for(;r&&o.test(r)&&e!==s.length;)a+=r,r=s[++e];if(a=="true"||a=="false"||a==="null")t.push({type:"name",value:a});else{e++;continue}continue}e++}return t},Y=s=>{if(s.length===0)return s;let e=s[s.length-1];switch(e.type){case"separator":return s=s.slice(0,s.length-1),Y(s);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return s=s.slice(0,s.length-1),Y(s);case"string":let r=s[s.length-2];if(r?.type==="delimiter")return s=s.slice(0,s.length-1),Y(s);if(r?.type==="brace"&&r.value==="{")return s=s.slice(0,s.length-1),Y(s);break;case"delimiter":return s=s.slice(0,s.length-1),Y(s);break}return s},$r=s=>{let e=[];return s.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?s.push({type:"brace",value:"}"}):t==="]"&&s.push({type:"paren",value:"]"})}),s},jr=s=>{let e="";return s.map(t=>{t.type==="string"?e+='"'+t.value+'"':e+=t.value}),e},Fe=s=>JSON.parse(jr($r(Y(qr(s)))));var y=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},l=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},S,O,fe,qe,pe,me,$e,ge,v,ye,je,De,Z,Le,Ue,pt,Lt,mt,gt,yt,wt,Ut,Wt="__json_buf",We=class s{constructor(){S.add(this),this.messages=[],this.receivedMessages=[],O.set(this,void 0),this.controller=new AbortController,fe.set(this,void 0),qe.set(this,()=>{}),pe.set(this,()=>{}),me.set(this,void 0),$e.set(this,()=>{}),ge.set(this,()=>{}),v.set(this,{}),ye.set(this,!1),je.set(this,!1),De.set(this,!1),Z.set(this,!1),Le.set(this,void 0),Ue.set(this,void 0),mt.set(this,e=>{if(y(this,je,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new g),e instanceof g)return y(this,De,!0,"f"),this._emit("abort",e);if(e instanceof c)return this._emit("error",e);if(e instanceof Error){let t=new c(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new c(String(e)))}),y(this,fe,new Promise((e,t)=>{y(this,qe,e,"f"),y(this,pe,t,"f")}),"f"),y(this,me,new Promise((e,t)=>{y(this,$e,e,"f"),y(this,ge,t,"f")}),"f"),l(this,fe,"f").catch(()=>{}),l(this,me,"f").catch(()=>{})}get response(){return l(this,Le,"f")}get request_id(){return l(this,Ue,"f")}async withResponse(){let e=await l(this,fe,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new s;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new s;for(let i of t.messages)n._addMessageParam(i);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},l(this,mt,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),l(this,S,"m",gt).call(this);let{response:i,data:o}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(i);for await(let a of o)l(this,S,"m",yt).call(this,a);if(o.controller.signal?.aborted)throw new g;l(this,S,"m",wt).call(this)}_connected(e){this.ended||(y(this,Le,e,"f"),y(this,Ue,e?.headers.get("request-id"),"f"),l(this,qe,"f").call(this,e),this._emit("connect"))}get ended(){return l(this,ye,"f")}get errored(){return l(this,je,"f")}get aborted(){return l(this,De,"f")}abort(){this.controller.abort()}on(e,t){return(l(this,v,"f")[e]||(l(this,v,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=l(this,v,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(l(this,v,"f")[e]||(l(this,v,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{y(this,Z,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){y(this,Z,!0,"f"),await l(this,me,"f")}get currentMessage(){return l(this,O,"f")}async finalMessage(){return await this.done(),l(this,S,"m",pt).call(this)}async finalText(){return await this.done(),l(this,S,"m",Lt).call(this)}_emit(e,...t){if(l(this,ye,"f"))return;e==="end"&&(y(this,ye,!0,"f"),l(this,$e,"f").call(this));let r=l(this,v,"f")[e];if(r&&(l(this,v,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!l(this,Z,"f")&&!r?.length&&Promise.reject(n),l(this,pe,"f").call(this,n),l(this,ge,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!l(this,Z,"f")&&!r?.length&&Promise.reject(n),l(this,pe,"f").call(this,n),l(this,ge,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",l(this,S,"m",pt).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),l(this,S,"m",gt).call(this),this._connected(null);let n=E.fromReadableStream(e,this.controller);for await(let i of n)l(this,S,"m",yt).call(this,i);if(n.controller.signal?.aborted)throw new g;l(this,S,"m",wt).call(this)}[(O=new WeakMap,fe=new WeakMap,qe=new WeakMap,pe=new WeakMap,me=new WeakMap,$e=new WeakMap,ge=new WeakMap,v=new WeakMap,ye=new WeakMap,je=new WeakMap,De=new WeakMap,Z=new WeakMap,Le=new WeakMap,Ue=new WeakMap,mt=new WeakMap,S=new WeakSet,pt=function(){if(this.receivedMessages.length===0)throw new c("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Lt=function(){if(this.receivedMessages.length===0)throw new c("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new c("stream ended without producing a content block with type=text");return t.join(" ")},gt=function(){this.ended||y(this,O,void 0,"f")},yt=function(t){if(this.ended)return;let r=l(this,S,"m",Ut).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let n=r.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{n.type==="tool_use"&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{y(this,O,r,"f");break}case"content_block_start":case"message_delta":break}},wt=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");let t=l(this,O,"f");if(!t)throw new c("request ended without sending any chunks");return y(this,O,void 0,"f"),t},Ut=function(t){let r=l(this,O,"f");if(t.type==="message_start"){if(r)throw new c(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new c(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let n=r.content.at(t.index);switch(t.delta.type){case"text_delta":{n?.type==="text"&&(n.text+=t.delta.text);break}case"citations_delta":{n?.type==="text"&&(n.citations??(n.citations=[]),n.citations.push(t.delta.citation));break}case"input_json_delta":{if(n?.type==="tool_use"){let i=n[Wt]||"";i+=t.delta.partial_json,Object.defineProperty(n,Wt,{value:i,enumerable:!1,writable:!0}),i&&(n.input=Fe(i))}break}case"thinking_delta":{n?.type==="thinking"&&(n.thinking+=t.delta.thinking);break}case"signature_delta":{n?.type==="thinking"&&(n.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new E(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var Ht={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"},F=class extends m{constructor(){super(...arguments),this.batches=new W(this._client)}create(e,t){let{betas:r,...n}=e;return n.model in Ht&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${Ht[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages?beta=true",{body:n,timeout:this._client._options.timeout??(n.stream?6e5:this._client._calculateNonstreamingTimeout(n.max_tokens)),...t,headers:{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0,...t?.headers},stream:e.stream??!1})}stream(e,t){return We.createMessage(this,e,t)}countTokens(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t?.headers}})}};F.Batches=W;F.BetaMessageBatchesPage=Q;var A=class extends m{constructor(){super(...arguments),this.models=new U(this._client),this.messages=new F(this._client)}};A.Models=U;A.BetaModelInfosPage=G;A.Messages=F;var H=class extends m{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}};var V=class extends m{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/v1/messages/batches/${e}`,t)}list(e={},t){return x(e)?this.list({},e):this._client.getAPIList("/v1/messages/batches",ee,{query:e,...t})}delete(e,t){return this._client.delete(`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let r=await this.retrieve(e);if(!r.results_url)throw new c(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})._thenUnwrap((n,i)=>z.fromResponse(i.response,i.controller))}},ee=class extends M{};V.MessageBatchesPage=ee;var w=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},u=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},P,q,we,He,be,_e,Ve,xe,B,Se,Ke,Xe,te,Je,Ge,bt,Vt,_t,xt,St,Pt,Kt,Xt="__json_buf",ze=class s{constructor(){P.add(this),this.messages=[],this.receivedMessages=[],q.set(this,void 0),this.controller=new AbortController,we.set(this,void 0),He.set(this,()=>{}),be.set(this,()=>{}),_e.set(this,void 0),Ve.set(this,()=>{}),xe.set(this,()=>{}),B.set(this,{}),Se.set(this,!1),Ke.set(this,!1),Xe.set(this,!1),te.set(this,!1),Je.set(this,void 0),Ge.set(this,void 0),_t.set(this,e=>{if(w(this,Ke,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new g),e instanceof g)return w(this,Xe,!0,"f"),this._emit("abort",e);if(e instanceof c)return this._emit("error",e);if(e instanceof Error){let t=new c(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new c(String(e)))}),w(this,we,new Promise((e,t)=>{w(this,He,e,"f"),w(this,be,t,"f")}),"f"),w(this,_e,new Promise((e,t)=>{w(this,Ve,e,"f"),w(this,xe,t,"f")}),"f"),u(this,we,"f").catch(()=>{}),u(this,_e,"f").catch(()=>{})}get response(){return u(this,Je,"f")}get request_id(){return u(this,Ge,"f")}async withResponse(){let e=await u(this,we,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new s;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new s;for(let i of t.messages)n._addMessageParam(i);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},u(this,_t,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),u(this,P,"m",xt).call(this);let{response:i,data:o}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(i);for await(let a of o)u(this,P,"m",St).call(this,a);if(o.controller.signal?.aborted)throw new g;u(this,P,"m",Pt).call(this)}_connected(e){this.ended||(w(this,Je,e,"f"),w(this,Ge,e?.headers.get("request-id"),"f"),u(this,He,"f").call(this,e),this._emit("connect"))}get ended(){return u(this,Se,"f")}get errored(){return u(this,Ke,"f")}get aborted(){return u(this,Xe,"f")}abort(){this.controller.abort()}on(e,t){return(u(this,B,"f")[e]||(u(this,B,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=u(this,B,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(u(this,B,"f")[e]||(u(this,B,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{w(this,te,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){w(this,te,!0,"f"),await u(this,_e,"f")}get currentMessage(){return u(this,q,"f")}async finalMessage(){return await this.done(),u(this,P,"m",bt).call(this)}async finalText(){return await this.done(),u(this,P,"m",Vt).call(this)}_emit(e,...t){if(u(this,Se,"f"))return;e==="end"&&(w(this,Se,!0,"f"),u(this,Ve,"f").call(this));let r=u(this,B,"f")[e];if(r&&(u(this,B,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!u(this,te,"f")&&!r?.length&&Promise.reject(n),u(this,be,"f").call(this,n),u(this,xe,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!u(this,te,"f")&&!r?.length&&Promise.reject(n),u(this,be,"f").call(this,n),u(this,xe,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",u(this,P,"m",bt).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),u(this,P,"m",xt).call(this),this._connected(null);let n=E.fromReadableStream(e,this.controller);for await(let i of n)u(this,P,"m",St).call(this,i);if(n.controller.signal?.aborted)throw new g;u(this,P,"m",Pt).call(this)}[(q=new WeakMap,we=new WeakMap,He=new WeakMap,be=new WeakMap,_e=new WeakMap,Ve=new WeakMap,xe=new WeakMap,B=new WeakMap,Se=new WeakMap,Ke=new WeakMap,Xe=new WeakMap,te=new WeakMap,Je=new WeakMap,Ge=new WeakMap,_t=new WeakMap,P=new WeakSet,bt=function(){if(this.receivedMessages.length===0)throw new c("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Vt=function(){if(this.receivedMessages.length===0)throw new c("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new c("stream ended without producing a content block with type=text");return t.join(" ")},xt=function(){this.ended||w(this,q,void 0,"f")},St=function(t){if(this.ended)return;let r=u(this,P,"m",Kt).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let n=r.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{n.type==="tool_use"&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{w(this,q,r,"f");break}case"content_block_start":case"message_delta":break}},Pt=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");let t=u(this,q,"f");if(!t)throw new c("request ended without sending any chunks");return w(this,q,void 0,"f"),t},Kt=function(t){let r=u(this,q,"f");if(t.type==="message_start"){if(r)throw new c(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new c(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let n=r.content.at(t.index);switch(t.delta.type){case"text_delta":{n?.type==="text"&&(n.text+=t.delta.text);break}case"citations_delta":{n?.type==="text"&&(n.citations??(n.citations=[]),n.citations.push(t.delta.citation));break}case"input_json_delta":{if(n?.type==="tool_use"){let i=n[Xt]||"";i+=t.delta.partial_json,Object.defineProperty(n,Xt,{value:i,enumerable:!1,writable:!0}),i&&(n.input=Fe(i))}break}case"thinking_delta":{n?.type==="thinking"&&(n.thinking+=t.delta.thinking);break}case"signature_delta":{n?.type==="thinking"&&(n.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new E(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var I=class extends m{constructor(){super(...arguments),this.batches=new V(this._client)}create(e,t){return e.model in Jt&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Jt[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??(e.stream?6e5:this._client._calculateNonstreamingTimeout(e.max_tokens)),...t,stream:e.stream??!1})}stream(e,t){return ze.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},Jt={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};I.Batches=V;I.MessageBatchesPage=ee;var $=class extends m{retrieve(e,t){return this._client.get(`/v1/models/${e}`,t)}list(e={},t){return x(e)?this.list({},e):this._client.getAPIList("/v1/models",K,{query:e,...t})}},K=class extends M{};$.ModelInfosPage=K;var Gt,d=class extends Te{constructor({baseURL:e=Oe("ANTHROPIC_BASE_URL"),apiKey:t=Oe("ANTHROPIC_API_KEY")??null,authToken:r=Oe("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){let i={apiKey:t,authToken:r,...n,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Dt())throw new c(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new H(this),this.messages=new I(this),this.models=new $(this),this.beta=new A(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){let t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!he(t)?t:r!=null&&!he(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}};Gt=d;d.Anthropic=Gt;d.HUMAN_PROMPT=`

Human:`;d.AI_PROMPT=`

Assistant:`;d.DEFAULT_TIMEOUT=6e5;d.AnthropicError=c;d.APIError=p;d.APIConnectionError=N;d.APIConnectionTimeoutError=X;d.APIUserAbortError=g;d.NotFoundError=ie;d.ConflictError=oe;d.RateLimitError=ce;d.BadRequestError=re;d.AuthenticationError=se;d.InternalServerError=le;d.PermissionDeniedError=ne;d.UnprocessableEntityError=ae;d.toFile=It;d.fileFromPath=Me;d.Completions=H;d.Messages=I;d.Models=$;d.ModelInfosPage=K;d.Beta=A;var{HUMAN_PROMPT:Mn,AI_PROMPT:An}=d,zt=d;var Qe=class{client=null;settings;constructor(e){this.settings=e,this.initClient()}initClient(){this.settings.apiKey&&(this.client=new zt({apiKey:this.settings.apiKey}))}updateSettings(e){this.settings=e,this.initClient()}isConfigured(){return!!this.client&&!!this.settings.apiKey}async sendMessage(e,t,r){if(!this.client)throw new Error("Claude API key not configured");let n=e.map(a=>({role:a.role,content:a.content}));if(this.settings.streamResponses&&r)return this.streamMessage(n,t,r);let o=(await this.client.messages.create({model:this.settings.model,max_tokens:4096,system:t,messages:n})).content.find(a=>a.type==="text");return o?.type==="text"?o.text:""}async streamMessage(e,t,r){if(!this.client)throw new Error("Claude API key not configured");let n="",i=this.client.messages.stream({model:this.settings.model,max_tokens:4096,system:t,messages:e});for await(let o of i)if(o.type==="content_block_delta"&&o.delta.type==="text_delta"){let a=o.delta.text;n+=a,r(a)}return n}};var Ye=class{settings;preferences=[];constructor(e){this.settings=e}updateSettings(e){this.settings=e}async loadPreferences(){return this.preferences=[{id:"cotton-react",name:"Cotton React Conventions",priority:100,tags:["react","typescript"],content:`## React Conventions

- Use named exports, not default exports
- Use function declarations with forwardRef
- Add displayName for debugging
- Use semantic tokens, never primitives

## Example

\`\`\`tsx
export const CottonButton = forwardRef<HTMLButtonElement, Props>(
  function CottonButton(props, ref) {
    return <button ref={ref} {...props} />;
  }
);
CottonButton.displayName = 'CottonButton';
\`\`\``},{id:"cotton-tokens",name:"Cotton Design Tokens",priority:100,tags:["css","tokens"],content:"## Design Tokens\n\nAlways use semantic tokens:\n- `--cotton-color-text-primary` (not `--cotton-color-gray-900`)\n- `--cotton-color-action-primary` (not `--cotton-color-blue-500`)\n- `--cotton-spacing-4` (not `16px`)\n\n## BEM Naming\n\n```css\n.cotton-btn { }           /* Block */\n.cotton-btn--primary { }  /* Modifier */\n.cotton-btn__icon { }     /* Element */\n```"}],this.preferences}formatForSystemPrompt(){return this.preferences.length===0?"":`## Cotton AI Preferences

The following coding standards and conventions should be followed:

${this.preferences.sort((t,r)=>r.priority-t.priority).map(t=>`### ${t.name}

${t.content}`).join(`

---

`)}`}};var Ze=class{app;settings;constructor(e,t){this.app=e,this.settings=t}updateSettings(e){this.settings=e}async buildContext(e,t){if(!e)return null;let r=await this.app.vault.read(e),n=this.app.metadataCache.getFileCache(e)?.frontmatter,i={path:e.path,name:e.basename,content:this.truncateContent(r),frontmatter:n,selection:t};return this.settings.includeBacklinks&&(i.backlinks=this.getBacklinks(e)),i}truncateContent(e){let t=e.split(`
`);return t.length<=this.settings.contextLines?e:t.slice(0,this.settings.contextLines).join(`
`)+`

[...truncated]`}getBacklinks(e){let t=[],r=this.app.metadataCache.resolvedLinks;for(let[n,i]of Object.entries(r))i[e.path]&&t.push(n);return t.slice(0,10)}formatContextForPrompt(e){let t=`## Current Note: ${e.name}

`;return e.frontmatter&&(t+=`### Frontmatter
\`\`\`yaml
${JSON.stringify(e.frontmatter,null,2)}
\`\`\`

`),e.selection&&(t+=`### Selected Text
\`\`\`
${e.selection}
\`\`\`

`),t+=`### Content
\`\`\`markdown
${e.content}
\`\`\`
`,e.backlinks&&e.backlinks.length>0&&(t+=`
### Backlinks
${e.backlinks.map(r=>`- [[${r}]]`).join(`
`)}
`),t}};var R=require("obsidian"),et=class extends R.Modal{plugin;editor;context;inputEl=null;responseEl=null;constructor(e,t,r,n){super(e),this.plugin=t,this.editor=r,this.context=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("cotton-ask-claude-modal"),e.createEl("h2",{text:"Ask Claude"}),this.context&&e.createEl("p",{text:`Context: ${this.context.name}`,cls:"cotton-context-label"});let t=e.createDiv({cls:"cotton-input-container"});if(this.inputEl=new R.TextAreaComponent(t),this.inputEl.inputEl.addClass("cotton-input"),this.inputEl.setPlaceholder("Ask a question about this note..."),this.inputEl.inputEl.rows=3,this.context?.selection){let o=e.createDiv({cls:"cotton-selection-preview"});o.createEl("strong",{text:"Selected: "}),o.createEl("code",{text:this.context.selection.length>100?this.context.selection.slice(0,100)+"...":this.context.selection})}let r=e.createDiv({cls:"cotton-button-container"});r.createEl("button",{text:"Ask",cls:"mod-cta"}).addEventListener("click",()=>this.handleAsk()),r.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),this.responseEl=e.createDiv({cls:"cotton-response"}),this.responseEl.style.display="none",this.inputEl.inputEl.focus(),this.inputEl.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&(o.metaKey||o.ctrlKey)&&this.handleAsk()})}async handleAsk(){let e=this.inputEl?.getValue();if(!e?.trim()){new R.Notice("Please enter a question");return}if(!this.plugin.claude.isConfigured()){new R.Notice("Claude API key not configured. Check settings.");return}this.responseEl&&(this.responseEl.style.display="block",this.responseEl.empty(),this.responseEl.createEl("p",{text:"Thinking...",cls:"cotton-thinking"}));try{let t=this.plugin.preferences.formatForSystemPrompt(),r=this.context?this.plugin.contextBuilder.formatContextForPrompt(this.context):"",n=`You are a helpful AI assistant integrated with Obsidian. You help users with their notes and coding tasks.

${t}

${r}

Respond concisely and helpfully. Use markdown formatting.`,i=[{role:"user",content:e,timestamp:Date.now()}],o="";if(this.responseEl&&this.responseEl.empty(),o=await this.plugin.claude.sendMessage(i,n,a=>{this.responseEl&&(this.responseEl.textContent=(this.responseEl.textContent||"")+a)}),this.responseEl&&o){this.responseEl.empty();let a=this.responseEl.createDiv({cls:"cotton-response-content"});a.innerHTML=o}}catch(t){new R.Notice(`Error: ${t instanceof Error?t.message:"Unknown error"}`),this.responseEl&&(this.responseEl.empty(),this.responseEl.createEl("p",{text:`Error: ${t instanceof Error?t.message:"Unknown error"}`,cls:"cotton-error"}))}}onClose(){let{contentEl:e}=this;e.empty()}};function Qt(s){s.addCommand({id:"ask-claude",name:"Ask Claude",editorCallback:async(e,t)=>{let r=e.getSelection(),n=t.file,i=n?await s.contextBuilder.buildContext(n,r||void 0):null;new et(s.app,s,e,i).open()}}),s.addCommand({id:"ask-claude-general",name:"Ask Claude (General)",callback:async()=>{let t=s.app.workspace.getActiveViewOfType(R.MarkdownView)?.file||null,r=t?await s.contextBuilder.buildContext(t):null;new et(s.app,s,null,r).open()}})}var kt={apiKey:"",model:"claude-sonnet-4-20250514",personalPrefsPath:"",teamPrefsPath:"",streamResponses:!0,contextLines:100,includeBacklinks:!0};var tt=class extends Yt.Plugin{settings=kt;claude;preferences;contextBuilder;async onload(){console.log("Loading Cotton AI plugin"),await this.loadSettings(),this.claude=new Qe(this.settings),this.preferences=new Ye(this.settings),this.contextBuilder=new Ze(this.app,this.settings),await this.preferences.loadPreferences(),this.addSettingTab(new ke(this.app,this)),Qt(this),this.addRibbonIcon("message-circle","Cotton AI",()=>{this.app.commands.executeCommandById("cotton-ai:ask-claude-general")}),console.log("Cotton AI plugin loaded")}onunload(){console.log("Unloading Cotton AI plugin")}async loadSettings(){this.settings=Object.assign({},kt,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.claude.updateSettings(this.settings),this.preferences.updateSettings(this.settings),this.contextBuilder.updateSettings(this.settings)}};
